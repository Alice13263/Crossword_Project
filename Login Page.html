<!DOCTYPE html>
<html lang="en-GB">
    <head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	    <title>Login - Crossword Generator & Solver</title>
        <link rel = "stylesheet" href = "CSS_stylesheet.css">
    </head>
    <body>
       <div class = "wrapper">
            <a class = "top"></a>
            <header class = "login_header">
                <div class = "accessibility_menu_button_div">
                    <!-- Add the function to the accesibility menu button when the page has been created -->
                    <button type = "button" class = "accessibility_menu_button elements_overlay"></button>
                </div>
            </header>
            <main>
                <div class = "page_title_container">
                    <h1 class = "text page_title">Login</h1>
                    <h3 class = "text page_subtitle">Crossword Clue Solver & Generator</h3>
                </div>
                <div class = "enter_info_container">
                    <div class = "enter_div">
                        <div class = "info_enter_area">
                            <p class = "text" style = "font-weight: bold;">Username:</p>
                            <input type = "text" class = "text input_field" id = "username_input" placeholder = "Minimum 8 Characters" required = "required">
                        </div>
                        <!-- Text will be added when the user inputs invalid info -->
                        <p id = "error_username" class = "text" style = "color: rgb(240,36,29);"></p>
                    </div>
                    <div class = "enter_div">
                        <div class = "info_enter_area">
                            <p class = "text" style = "font-weight: bold;">Password:</p>
                            <input type = "text" class = "text input_field" id = "password_input" placeholder = "Minimum 8 Characters" required = "required">
                        </div>
                        <!-- Text will be added when the user inputs invalid info -->
                        <p id = "error_password" class = "text" style = "color: rgb(240,36,29);"></p>
                    </div>
                </div>
                <div class = "submit_button_div">
                    <button type = "button" class = "submit_button text elements_overlay" onclick = "validLogin()">SUBMIT</button>
                </div>
                <div class = "login_link_div">
                    <a class = "text" href = "Create Account Page.html">Don't have an account? Create one here</a>
                </div>
            </main>
       </div>
       <script>
            // This regex tests for matching 'word characters' only accepts letters (not case sensitive), 0-9 and underscores - which is what I outlined in the key validation section was needed
            const valid_username = /^\w+$/;
            // This regex tests for a valid password - it must have at least one upper case, one lower case, one integer and one special character
            const valid_password = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%?=*&Â£]).*$/;
            async function loginUser(){
                const username = document.getElementById("username_input").value.trim();
                const password = document.getElementById("password_input").value.trim();
                const response = await fetch("http://127.0.0.1:5000/userLogin",{
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({username, password})
                });
                const login_result = await response.json();
                if (login_result.success) {
                    localStorage.setItem("username", login_result.username);
                    window.location.href = "Main Menu Page.html";
                }
                else{
                    document.getElementById("error_username").innerText = "Invalid username or password";
                }
            };
            function validateUsername(username){
                var entered_username = document.getElementById(username).value;
                if ((entered_username.length < 8) || (valid_username.test(entered_username) == false)){
                    const username_error = document.getElementById("error_username");
                    username_error.innerText = "Must be at least 8 characters, only letters, numbers and underscores";
                }
                else{
                    const username_no_error = document.getElementById("error_username");
                    username_no_error.innerText = "";
                    return true
                }
            };
            function validatePassword(password){
                var entered_password = document.getElementById(password).value;
                if ((entered_password.length < 8) || (valid_password.test(entered_password) == false)){
                    const password_error = document.getElementById("error_password");
                    password_error.innerText = "Must be at least 8 characters, at least 1 upper case, lower case, integer, and special character"
                }
                else{
                    const password_no_error = document.getElementById("error_password");
                    password_no_error.innerText = "";
                    return true
                }
            };
            function validLogin(){
                if ((validateUsername("username_input") == true) && (validatePassword("password_input") == true)){
                    loginUser()
                }
            };
       </script>
    </body>
</html>