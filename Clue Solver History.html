<!--Setting up the basic layout of the webpage-->
<!DOCTYPE html>
<html lang="en-GB">
    <head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	    <title>Clue Solver History - Crossword Generator & Solver</title>
        <link rel = "stylesheet" href = "CSS_stylesheet.css">
    </head>
    <body>
        <div class = "wrapper">
            <a class = "top"></a>
            <header class = "crossword_header">
                <div class = "back_button_div">
                    <a href = "Player History.html">
                        <button type = "button" class = "back_button elements_overlay"></button>
                    </a>
                </div>
                <div class = "accessibility_menu_button_div">
                    <!-- Add the function to the accesibility menu button when the page has been created -->
                    <button type = "button" class = "accessibility_menu_button elements_overlay"></button>
                </div>
            </header>
            <main>
                <div class = "page_title_container">
                    <h1 class = "text page_title">Crossword Clue Solver History</h1>
                    <!--If no previous clues, text will be added here-->
                    <p class = "text" id = "history_status"></p>
                </div>
                <!--If there are previous clues, they will be displayed inside here-->
                <div class = "clue_history_div" id = "clue_history_container">
                </div>
            </main>
        </div>
        <script>
            const username = localStorage.getItem("username");
            const history_container = document.getElementById("clue_history_container");
            const history_text = document.getElementById("history_status");
            if (!username){
                window.location.href = "http://127.0.0.1:5500/Login%20Page.html"
            }
            //Function runs once JSON is retrieved from the Python backend
            async function displayHistory(username){
                const response = await fetch("http://127.0.0.1:5001/clueSolverHistory",{
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    //Username is sent to backend, so database can be checked for clues user has entered
                    body: JSON.stringify({username: username})
                });
                //Stores results of the database search
                const login_result = await response.json();
                //Clearing the page of previous results
                history_container.innerHTML = "";
                //If the user has not searched clues before, a message is displayed
                if (login_result.success == false){
                    history_text.innerText = "No Clues Solved";
                    history_text.style = "color: rgb(240,36,29); font-size: 2.8vw;";
                    return;
                }
                //Adding elements to the page to display the answers
                const clue_container = document.createElement("div");
                clue_container.className = "clue_container";
                history_container.appendChild(clue_container)
                const clue_title = document.createElement("p");
                clue_title.classList.add("page_subtitle")
                clue_title.classList.add("text")
                clue_title.innerText = "Clue";
                clue_container.appendChild(clue_title);
                const clue_number_letters = document.createElement("p");
                clue_number_letters.classList.add("page_subtitle");
                clue_number_letters.classList.add("text");
                clue_number_letters.innerText = "Number of Letters";
                clue_container.appendChild(clue_number_letters);
                const clue_given_letters = document.createElement("p");
                clue_given_letters.classList.add("page_subtitle");
                clue_given_letters.classList.add("text");
                clue_given_letters.innerText = "Letters Given";
                clue_container.appendChild(clue_given_letters);
                //Looping through all clues the user has searched before to display each one
                for (let clue_no = 0; clue_no < login_result.history.length; clue_no++){
                    let current_clue = login_result.history[clue_no];
                    const full_clue_container = document.createElement("div");
                    full_clue_container.className = "full_clue_container";
                    history_container.appendChild(full_clue_container);
                    const clue_info_container = document.createElement("div");
                    clue_info_container.className = "clue_container";
                    clue_info_container.style = "justify-content: space-around;";
                    full_clue_container.appendChild(clue_info_container);
                    const clue_name = document.createElement("p");
                    clue_name.classList.add("text")
                    clue_name.style = "font-size: 1.75vw; font-weight: bold;"
                    clue_name.innerText = current_clue.clue;
                    clue_info_container.appendChild(clue_name);
                    const number_letters = document.createElement("p");
                    number_letters.classList.add("text");
                    number_letters.style = "font-size: 1.75vw; font-weight: bold;"
                    number_letters.innerText = current_clue.length;
                    clue_info_container.appendChild(number_letters);
                    const clue_letters = document.createElement("p");
                    clue_letters.classList.add("text");
                    clue_letters.style = "font-size: 1.75vw; font-weight: bold;"
                    clue_letters.innerText = current_clue.pattern;
                    clue_info_container.appendChild(clue_letters);
                    const answer_container = document.createElement("div");
                    answer_container.className = "answer_column_container";
                    full_clue_container.appendChild(answer_container);
                    const answer_column = document.createElement("div");
                    answer_column.className = "answers_column";
                    answer_container.appendChild(answer_column);
                    const percentage_column = document.createElement("div");
                    percentage_column.className = "answers_column";
                    answer_container.appendChild(percentage_column);
                    //Looping through each answer for the clue, to display each one and their confidence percentages
                    for(let ans = 0; ans < current_clue.answers.length; ans++){
                        let answer_text = current_clue.answers[ans];
                        const ans_text = document.createElement("p");
                        ans_text.className = "text";
                        ans_text.innerText = answer_text.answer;
                        answer_column.appendChild(ans_text);
                        const perc_text = document.createElement("p");
                        perc_text.className = "text";
                        perc_text.innerText = answer_text.confidence;
                        percentage_column.appendChild(perc_text);
                    };
                };
            };
            //Runs the function immediately
            displayHistory(username)
        </script>
    </body>
</html>